 <!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Bank Soal Generator</title>

<style>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
  background: #f4f6f9;
}

h2 {
  margin-bottom: 10px;
}

input[type=text] {
  padding: 8px;
  width: 300px;
}

button {
  padding: 10px 20px;
  background: #1a73e8;
  color: white;
  border: none;
  cursor: pointer;
  border-radius: 4px;
}

button:hover {
  background: #0c5bd3;
}

table {
  border-collapse: collapse;
  width: 100%;
  background: white;
  margin-top: 15px;
}

th, td {
  border: 1px solid #ddd;
  padding: 8px;
}

th {
  background: #f1f3f4;
}

#loading {
  color: red;
  margin-top: 10px;
}
</style>
</head>

<body>

<h2>Bank Soal - Generate Form & Document</h2>

<label>Nama File (Form & Doc):</label><br>
<input type="text" id="namaFile" placeholder="Contoh: Ujian Matematika Kelas 9">
<br><br>

<button onclick="generate()">Generate Sekarang</button>

<div id="loading"></div>

<table>
<thead>
<tr>
<th>Pilih</th>
<th>No</th>
<th>Soal</th>
</tr>
</thead>
<tbody id="tbody">
<tr><td colspan="3">Memuat data...</td></tr>
</tbody>
</table>

<script>

const API = "https://script.google.com/macros/s/AKfycbzP7fg0aEAnFhftYzUP7l1zxZra5of-2jbJetnxFId_11CUfweuC41vE5mxd4JlxyJL4w/exec";

// =======================
// LOAD BANK SOAL
// =======================

fetch(API + "?action=getSoal")
.then(response => response.json())
.then(data => {

  let html = "";

  data.forEach(item => {
    html += `
      <tr>
        <td><input type="checkbox" value="${item.index}"></td>
        <td>${item.no}</td>
        <td>${item.soal}</td>
      </tr>
    `;
  });

  document.getElementById("tbody").innerHTML = html;
})
.catch(err => {
  document.getElementById("tbody").innerHTML =
    "<tr><td colspan='3'>Gagal memuat data</td></tr>";
});

// =======================
// GENERATE FORM + DOC
// =======================

function generate() {

  const namaFile = document.getElementById("namaFile").value.trim();

  if (!namaFile) {
    alert("Silakan isi nama file terlebih dahulu.");
    return;
  }

  const checked = document.querySelectorAll("input[type=checkbox]:checked");

  if (checked.length === 0) {
    alert("Pilih minimal 1 soal.");
    return;
  }

  const selected = [];
  checked.forEach(cb => selected.push(parseInt(cb.value)));

  document.getElementById("loading").innerHTML = "Sedang membuat file...";

  fetch(API + "?action=generateAll"
        + "&namaFile=" + encodeURIComponent(namaFile)
        + "&selected=" + encodeURIComponent(JSON.stringify(selected)))
  .then(res => res.json())
  .then(data => {

    document.getElementById("loading").innerHTML = "";

    if (data.status === "success") {

      alert("Berhasil dibuat!");

      window.open(data.formUrl, "_blank");
      window.open(data.docUrl, "_blank");

    } else {
      alert("Terjadi kesalahan.");
    }

  })
  .catch(err => {
    document.getElementById("loading").innerHTML = "";
    alert("Error koneksi ke server.");
  });
}

</script>

</body>
</html>
